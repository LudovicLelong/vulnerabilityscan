package zap

import (
	"fmt"
	"io/ioutil"
	"net/http"
	"net/url"
)

const (
	ApiKey     = "mh20la1c8igrtk0h6ovbd5evtl" // Mise à jour de l'API key
	ZapBaseURL = "http://localhost:8082"
	Target     = "https://public-firing-range.appspot.com"
)

type ZAPv2 struct {
	APIKey  string
	BaseURL string
	Client  *http.Client
}

func NewZAPv2() *ZAPv2 {
	return &ZAPv2{
		APIKey:  ApiKey,
		BaseURL: ZapBaseURL,
		Client:  &http.Client{},
	}
}

func (zap *ZAPv2) request(endpoint string, params url.Values) ([]byte, error) {
	params.Add("apikey", zap.APIKey)
	fullURL := fmt.Sprintf("%s%s?%s", zap.BaseURL, endpoint, params.Encode())

	fmt.Printf("Request URL: %s\n", fullURL) // Log supplémentaire

	resp, err := zap.Client.Get(fullURL)
	if err != nil {
		return nil, err
	}
	defer resp.Body.Close()

	return ioutil.ReadAll(resp.Body)
}
